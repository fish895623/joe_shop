<!DOCTYPE html>
<html lang="en">
<head>
    <title>Product Detail</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        .container {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card {
            height: 70vh;
            width: 80%;
            max-width: 900px;
        }

        .card-img-left {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
            text-align: center;
        }

        .row.no-gutters {
            display: flex;
            align-items: center;
            height: 500px;
        }

        .btn-lg {
            font-size: 1.25rem;
            padding: 0.75rem 1.25rem;
        }
    </style>
</head>
<body>

<h2>Product Detail Page</h2>

<div class="container">
    <div class="card">
        <div class="row no-gutters">
            <div class="col-md-6">
                <img id="product-image" class="card-img-left" src="" alt="상품 이미지">
            </div>
            <!-- 오른쪽: 정보 (6:4 비율) -->
            <div class="col-md-6">
                <div class="card-body">
                    <h4 id="product-name" class="card-title">상품 이름</h4>
                    <p id="product-price" class="card-text">가격</p>
                    <div class="input-group mb-3" style="width: 150px; margin: auto;">
                        <div class="input-group-prepend">
                            <button class="btn btn-outline-secondary" type="button" id="decrease-btn">-</button>
                        </div>
                        <input type="text" class="form-control text-center" id="quantity-value" value="1" readonly>
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button" id="increase-btn">+</button>
                        </div>
                    </div>
                    <a href="#" id="add-to-cart" class="btn btn-primary btn-lg">장바구니 추가</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    //test
    // URL에서 상품 ID를 가져오는 방법
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');  // ?id=3 형태의 URL에서 id 값 가져오기
    console.log('상품 ID:', productId);

    //수량 증가, 감소 기능
    const decreaseButton = document.getElementById('decrease-btn');
    const increaseButton = document.getElementById('increase-btn');
    const quantityValue = document.getElementById('quantity-value');
    const addToCartButton = document.getElementById('add-to-cart-btn');  // 수정된 ID

    increaseButton.addEventListener('click', function () {
        let currentValue = parseInt(quantityValue.value);
        quantityValue.value = currentValue + 1;
    });

    decreaseButton.addEventListener('click', function () {
        let currentValue = parseInt(quantityValue.value);
        if (currentValue > 1) {
            quantityValue.value = currentValue - 1;
        }
    });

    // 상품 정보 가져오기
    fetch(`/product/get-by-product-id/${productId}`)
        .then(response => response.json())
        .then(data => {
            if (data && data.product) {
                const product = data.product;  // Response 객체에서 product 필드 추출
                console.log('상품 이미지 경로:', product.imageUrl);
                // HTML 요소에 상품 정보 삽입
                document.getElementById('product-name').innerText = product.name;
                document.getElementById('product-price').innerText = "가격: $" + product.price;
                document.getElementById('product-image').src = product.imageUrl || '';
                document.getElementById('product-name').innerText = product.name || "상품을 찾을 수 없습니다.";
            }
        })
        .catch(error => {
            console.error("Error fetching product data:", error);
        });

    // // 장바구니 추가 버튼 클릭 시 미완성
    // addToCartButton.addEventListener('click', function () {
    //     const quantity = parseInt(quantityValue.value);
    //
    //     // 장바구니에 상품 추가 API 호출
    //     fetch("/api/cart/append", {
    //         method: "POST",
    //         headers: {
    //             "Content-Type": "application/json"
    //         },
    //         body: JSON.stringify({
    //             productId: productId,
    //             quantity: quantity
    //         })
    //     })
    //         .then(response => response.json())
    //         .then(data => {
    //             if (data && data.status === 'success') {
    //                 // 장바구니 페이지로 리디렉션
    //                 window.location.href = "product/cart";
    //             } else {
    //                 alert("장바구니 추가 실패!");
    //             }
    //         })
    //         .catch(error => {
    //             console.error("Error adding to cart:", error);
    //             alert("장바구니 추가 중 오류 발생!");
    //         });
    // });
</script>

</body>
</html>
