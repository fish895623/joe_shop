<!DOCTYPE html>
<html lang="en">
<head>
    <title>Cart</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body>
<div class="cart-container">
    <h2>"This is the cart page."</h2>
    <p>The .thead-dark class adds a black background to table headers, and the .thead-light class adds a grey background
        to table headers:</p>
    <table class="table">
        <thead class="thead-dark">
        <tr>
            <th>images</th>
            <th>상품명</th>
            <th>가격</th>
            <th>수량</th>
        </tr>
        </thead>
        <tbody id="cart-items-tbody">
        </tbody>
    </table>
    <div class="button_container" style="text-align: right;">
        <h2 id="total-price">총금액:0</h2>
        <button type="button" class="btn btn-primary">쇼핑 계속하기</button>
        <button type="button" class="btn btn-primary active">주문하기</button>
    </div>
</div>

<script>
    const userId = 1;
    const apiUrl = `/api/cart-item/get-all/${userId}`;
    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            console.log(data);
            const cartItems = data.cartItemList || [];
            console.log(cartItems)

            let totalPrice = 0;
            const cartItemBody = document.getElementById("cart-items-tbody");
            cartItemBody.innerHTML = "";
            //Handle when there are no items in the cart
            if (cartItems.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="4">장바구니에 아이템이 없습니다.</td>`;
                cartItemBody.appendChild(row);
            } else {

                //Add each cart item to the table

                cartItems.forEach(item => {
                    const row = document.createElement('tr');

                    row.innerHTML = `
                        <td><img src="${item.product.imageUrl}" alt="Product Image" style="width: 50px; height: 50px;"></td>
                        <td>${item.product.productName}</td>
                        <td>${item.price}</td>
                        <td>${item.product.quantity}</td> <!-- item.product.quantity 사용 -->
                    `;
                    cartItemBody.appendChild(row);


                    //Calculate the total amount
                    totalPrice += item.price * item.product.quantity;
                });
            }
            document.getElementById("total-price").textContent = `총금액: ${totalPrice}`;
        })
        .catch(error => {
            console.error('Error fetching cart data:', error);
        });

</script>


</body>
</html>