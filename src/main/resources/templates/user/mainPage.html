<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MainPage</title>
    <link rel="stylesheet" href="/style.css" />
    <th:block th:replace="~{common/head :: library}"></th:block>
  </head>
  <body>
    <style>
      .nav-tabs {
        display: flex;
        justify-content: center;
        list-style-type: none;
        padding: 0;
      }
      .nav-item {
        margin: 0 10px;
      }

      /* Flexbox layout for product container */
      #productContainer {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        gap: 20px; /* Adjust gap between cards */
        padding: 20px;
      }

      /* Flex properties for each card */
      .card {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 20rem;
        margin: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
      }

      .card:hover {
        transform: translateY(-10px); /* Add hover effect */
      }

      .card-img-top {
        width: 100%;
        height: auto;
      }

      .card-body {
        padding: 10px;
        text-align: center;
      }

      .card-title {
        font-size: 1.1rem;
        margin-bottom: 10px;
      }

      .card-link input[type="button"] {
        padding: 8px 16px;
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
      }

      .card-link input[type="button"]:hover {
        background-color: #0056b3;
      }
    </style>
    <!-- Corrected th:replace to properly include the navbar fragment -->
    <th:block th:replace="~{common/navigation :: navbar}" />

    <ul class="nav nav-tabs" id="categoryTabs">
      <!-- Categories will be dynamically inserted here -->
    </ul>

    <div id="productContainer"></div>

<<<<<<< Updated upstream
    <div id="page-btn" class="pagination"></div>
=======
    <div id="page-btn"></div>
>>>>>>> Stashed changes

    <th:block th:replace="~{common/footer :: footer}" />

    <script>
      // Fetch all categories and dynamically generate the category tabs
      fetch("/category/get-all")
        .then((response) => response.json())
        .then((data) => {
          const categoryTabs = document.getElementById("categoryTabs");

          // Add the "All" tab first
          let allTab = `<li class="nav-item">
                  <a class="nav-link active" href="#" data-category="all">All</a>
                </li>`;
          categoryTabs.innerHTML = allTab;

          // Define the required tab order
          const categoryOrder = ["Women", "Men", "Kids", "Accessories"];
          const categories = data.categoryList;

          // Filter and reorder the categories based on the predefined order
          categoryOrder.forEach((categoryName) => {
            const category = categories.find(
              (cat) => cat.categoryName === categoryName
            );
            if (category) {
              const categoryTab = `<li class="nav-item">
                             <a class="nav-link" href="#" data-category="${category.id}">${category.categoryName}</a>
                           </li>`;
              categoryTabs.insertAdjacentHTML("beforeend", categoryTab);
            }
          });

          // Fetch products for the "All" category initially
          loadProducts("all");
        })
        .catch((error) => {
          console.error("Error fetching categories:", error);
        });

      document
        .getElementById("productContainer")
        .addEventListener("click", function (event) {
          if (event.target.id === "detail") {
            const productId = event.target.getAttribute("data-id");

            window.location.href = `/product?id=${productId}`;
          }
        });

      // Event listener to handle category click and load corresponding products
      document
        .getElementById("categoryTabs")
        .addEventListener("click", (event) => {
          event.preventDefault();

          if (event.target.tagName === "A") {
            const categoryId = event.target.getAttribute("data-category");
            loadProducts(categoryId);

            // Highlight the active tab
            const tabs = document.querySelectorAll(".nav-link");
            tabs.forEach((tab) => tab.classList.remove("active"));
            event.target.classList.add("active");
          }
        });

      // Function to load products based on the selected category

      let currentPage = 1;
      let totalCount = 0;
      const limit = 10;
      const pageCount = 5;
      let currentCategoryId = "all";
      function loadProducts(categoryId) {
        currentCategoryId = categoryId;
        fetch(
          categoryId === "all"
            ? "/product/get-all"
            : `/product/get-by-category-id/${categoryId}`
        )
          .then((response) => response.json())
          .then((data) => {
            const productList = data.productList || [];
            totalCount = data.totalCount || productList.length;
            //console.log("totalCount:", totalCount);
            const container = document.getElementById("productContainer");
            container.innerHTML = ""; // Clear the previous products

            const startPage = (currentPage - 1) * limit;
            const endPage = startPage + limit;
            const paginationProducts =
              productList.slice(startPage, endPage) || [];
            //console.log("paginationProducts:", paginationProducts);
            console.log("startPage:", startPage, "endPage:", endPage);
            console.log(
              "Second Page Products:",
              productList.slice(startPage, endPage)
            );

            paginationProducts.forEach((product) => {
              const productCard = `
<<<<<<< Updated upstream
                <div class="card" style="width: 18rem">
                  <img class="card-img-top" src="${
                    product.image || "dress.jpg"
                  }" alt="Card image cap" />
                  <div class="card-body">
                    <h5 class="card-title">${product.name}</h5>
                    <span>${product.price}</span>
                    <p>Category: ${
                      product.category ? product.category.categoryName : "N/A"
                    }</p> <!-- Show category -->
                  </div>
                  <div class="card-body">
                    <a href="#" class="card-link">
                      <input type="button" value="자세히 보기" />
                    </a>
                  </div>
                </div>
              `;
=======
          <div class="card" style="width: 18rem">
            <img class="card-img-top" src="${
              product.image || "dress.jpg"
            }" alt="Card image cap" />
            <div class="card-body">
              <h5 class="card-title">${product.name}</h5>
              <span>${product.price}</span>
              <p>Category: ${
                product.category ? product.category.categoryName : "N/A"
              }</p> <!-- Show category -->
            </div>
            <div class="card-body">
              <a href="#" class="card-link">
                <input type="button" value="자세히 보기" />
              </a>
            </div>
          </div>
        `;
>>>>>>> Stashed changes
              container.insertAdjacentHTML("beforeend", productCard);
            });

            renderPagination();
          })
          .catch((error) => {
            console.error("Error fetching products:", error);
          });
      }

      function loadProductsByKeyword(keyword) {
        fetch("/product/search?keyword=" + encodeURIComponent(keyword))
          .then((response) => response.json())
          .then((data) => {
            const productList = data.productList || [];
            const container = document.getElementById("productContainer");
            container.innerHTML = ""; // Clear the previous products

            if (productList.length > 0) {
              productList.forEach((product) => {
                const productCard = `
            <div class="card" style="width: 18rem">
              <img class="card-img-top" src="${
                product.image || "dress.jpg"
              }" alt="Card image cap" />
              <div class="card-body">
                <h5 class="card-title">${product.name}</h5>
                <p>Category: ${
                  product.category && product.category.categoryName
                    ? product.category.categoryName
                    : "N/A"
                }</p> <!-- Show category -->
                <span>${product.price}</span>
              </div>
              <div class="card-body">
                <a href="#" class="card-link">
                  <input type="button" value="자세히 보기" />
                </a>
              </div>
            </div>
          `;
                container.insertAdjacentHTML("beforeend", productCard); // Add product card
              });
            } else {
              container.innerHTML = "<p>검색 결과가 없습니다.</p>"; // Display message when no results
            }
          })
          .catch((error) => {
            console.error(
              "검색 결과를 가져오는 데 오류가 발생했습니다:",
              error
            );
          });
      }

<<<<<<< Updated upstream
      function renderPagination() {
        const totalPages = Math.ceil(totalCount / limit);
        console.log("totalPages:", totalPages);
        const pagination = document.getElementById("page-btn");
        if (!pagination) {
          console.error("페이지버튼 노노");
        }
        pagination.innerHTML = "";
        console.log("Pagination HTML:", pagination.innerHTML);

        if (totalPages === 0) {
          return;
        }

        const startPage =
          Math.floor((currentPage - 1) / pageCount) * pageCount + 1;
        const endPage = Math.min(startPage + pageCount - 1, totalPages);
        console.log(currentPage);

        pagination.innerHTML += `
          <button
            class="page-btn-child ${i === currentPage ? "active" : ""}"
            data-page="${i}">${i}
          </button>`;

      document.getElementById("page-btn").addEventListener("click", (event) => {
        if (event.target.classList.contains("page-btn")) {
          currentPage = parseInt(event.target.getAttribute("data-page"));
          console.log("페이지 변경 확인:", currentPage);
          loadProducts(currentCategoryId);
        }
      });
=======
      // async function fetchPages() {
      //   const response = await fetch("/product/get-all", {
      //     method: "GET",
      //     include: "credentials",
      //     headers: {
      //       "Content-Type": "application/json",
      //     },
      //   });
      //   const data = await response.json();
      //   return data.productList || [];
      // }
>>>>>>> Stashed changes
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
